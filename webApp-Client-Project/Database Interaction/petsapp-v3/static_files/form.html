<!DOCTYPE html>
<html>

   <head>
         <meta name="viewport" content="width=device-width, initial-scale=1">
         <title>Student Event Sign Up</title>
         <!-- The core Firebase JS SDK is always required and must be listed first -->
         <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>

        

         <script>
         // Your web app's Firebase configuration
         var firebaseConfig = {
            apiKey: "AIzaSyCCgoy1_bJzrruepLYIWBbrIUIGxM-p2CQ",
            authDomain: "signup-form-e4c78.firebaseapp.com",
            databaseURL: "https://signup-form-e4c78.firebaseio.com",
            projectId: "signup-form-e4c78",
            storageBucket: "signup-form-e4c78.appspot.com",
            messagingSenderId: "1000336889334",
            appId: "1:1000336889334:web:f5099e3a8ecc1584"
         };
         // Initialize Firebase
         firebase.initializeApp(firebaseConfig);
         </script>
         <script src="jquery-3.3.1.min.js"></script>
         <script type="text/javascript">
        
      
      
            function delineate(str)
                 {
                 theleft = str.indexOf("=") + 1;
                 theright = str.lastIndexOf("&");
                 return(str.substring(theleft, theright));
                 }
           $(document).ready(function()
           {
              const database=firebase.database();
              var locate = window.location
                 document.joe.burns.value = locate
                 
                 var text = document.joe.burns.value
                var myvar=delineate(text);
                $('input[name="studentID"]').val(myvar);
                const key='students/'+myvar;
               
                
                database.ref(key).once('value', (snapshot) => {
                const data= snapshot.val();
                if(!data){
                   console.log("DNE");
                   return;
      
                }
                if(data.first&&data.mi&&data.last&&data.gr){
                  $('input[id="studentID"]').val(myvar);
                  $('input[id="firstName"]').val(data.first);
                  $('input[id="lastName"]').val(data.last);
                  $('input[id="midInit"]').val(data.mi);
                  $('input[id="grade"]').val(data.gr);
      
      
                }
               });
                $('#saveButton').click(() => {
                 
                  const name = $('input[id="ticketNum"]').val();
         
                  database.ref('tickets/' + name).set({

                     sID: $('input[id="studentID"]').val(),
                     first:$('input[id="firstName"]').val(),
                  last:$('input[id="lastName"]').val(),
                  middle:$('input[id="midInit"]').val(),
                  grade:$('input[id="grade"]').val()
                  
                  });
                  $("input[type=text], textarea").val("");
                  alert("You have completed Prom Signup!");
             });
             $('#deleteButton').click(() => {
                  const name = $('input[id="ticketNum"]').val();
                  if (!(name===null)){
                     database.ref('tickets/' + name).remove();
                  }
             });
         });
           function visibility(box, item){
               if (box.checked === true){
                  document.getElementById(item).style.visibility = "visible";
               } else {
                  document.getElementById(item).style.visibility = "hidden";
               }
            }
      
        </script>
   </head>

   <style>
      * {
      box-sizing: border-box;
      }
      /* Create two equal columns that floats next to each other */
      .column {
      float: left;
      width: 50%;
      padding: 10px;
      }
      /* Clear floats after the columns */
      .row:after {
      content: "";
      display: table;
      clear: both;
      }
      form {
      padding-top: 50px;
      padding-left: 50px;
      line-height: 2;
      }
      .guest {
      padding-left: 20px;
      visibility: hidden;
      }
   </style>

   <FORM NAME="joe">
         <INPUT TYPE="hidden" NAME="burns">
         </FORM>
         
        
         
   <form name="myform">
      <div class="row">
         <div class="column">
            Ticket Number:  
            <input type="text" id="ticketNum" size="5"><br>
            Student ID:  
            <input type="text" id="studentID"  size="6" ><br>
            Last Name: 
            <input type="text" id="lastName" size="15"><br>
            First Name: 
            <input type="text" id="firstName" size="15"><br>
            Middle Initial:  
            <input type="text" id="midInit" size="1"><br>
            Grade:  
            <input type="text" id="grade" size="2"><br><br>
            Guest:  
            <input type="checkbox" name="guestBox" onclick="JavaScript:visibility(this,'guestForm');"><br>
            <div class= "guest" id= "guestForm">
               Last Name: 
               <input type="text" name="lastName" size="15"><br>
               First Name: 
               <input type="text" name="firstName" size="15"><br>
               <strong>Payment Method</strong><br>
               <input type="radio" name="pay" value="cash">Cash<br>
               <input type="radio" name="pay" value="check">Check  <input type="text" name="checkNum" placeholder="Check Number" size="12" maxLength="9"><br>
               <input type="radio" name="pay" value="waiver">Financial Waiver<br><br>
            </div>
         </div>
         <div class="column">
            <strong>Payment Method</strong><br>
            <input type="radio" name="pay" value="cash">Cash<br>
            <input type="radio" name="pay" value="check">Check  <input type="text" name="checkNum" placeholder="Check Number" size="12" maxLength="9"><br>
            <input type="radio" name="pay" value="waiver">Financial Waiver<br><br>
         </div>
         <strong>Student Obligations</strong><br>
         Obligations taken care of? <input type="checkbox" name="oblig"><br>
      </div>
      </div>
   </form>
      <div class="row">
         <div class="column">
           <!----> <button id="deleteButton">Delete</button>
         </div>
         <div class="column">
            <button id="saveButton">Save</button>
            <!--<input type="submit" value="Save" id="saveButton">-->
         </div>
      </div>
   

   


  </html>